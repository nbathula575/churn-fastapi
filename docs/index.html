<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Churn Prediction</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0b1220;
      --card:#121a2b;
      --muted:#9aa4b2;
      --text:#e6edf7;
      --line:rgba(255,255,255,.08);
      --good:#1a7f37;
      --bad:#b42318;
      --warn:#f59e0b;
      --accent:#60a5fa;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: radial-gradient(1200px 600px at 20% -10%, rgba(96,165,250,.25), transparent 60%),
                  radial-gradient(800px 600px at 90% 10%, rgba(34,197,94,.14), transparent 55%),
                  var(--bg);
      color:var(--text);
    }
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    .container{max-width:1100px; margin:28px auto; padding:0 16px;}
    .header{
      display:flex; justify-content:space-between; align-items:flex-end; gap:12px;
      margin-bottom:14px;
    }
    h1{margin:0; font-size:34px; letter-spacing:.2px}
    .sub{margin:4px 0 0; color:var(--muted); font-size:14px}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid var(--line); background:rgba(255,255,255,.02);
      padding:8px 12px; border-radius:999px; color:var(--muted); font-size:13px;
    }
    .grid{
      display:grid; grid-template-columns: 1.25fr .9fr;
      gap:16px; align-items:start;
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      padding:16px;
    }
    .card h3{margin:0 0 12px; font-size:16px; color:#f1f5ff}
    .inputs{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
    input, select{
      width:100%;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      color:var(--text);
      outline:none;
    }
    input:focus, select:focus{border-color: rgba(96,165,250,.55); box-shadow:0 0 0 3px rgba(96,165,250,.15)}
    .row{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center;
      margin-top:14px;
    }
    button{
      border:0;
      border-radius:12px;
      padding:10px 12px;
      cursor:pointer;
      font-weight:700;
      color:#06111f;
      background: linear-gradient(180deg, rgba(96,165,250,1), rgba(59,130,246,1));
    }
    button.secondary{
      background: rgba(255,255,255,.06);
      color:var(--text);
      border:1px solid var(--line);
      font-weight:600;
    }
    button:disabled{opacity:.55; cursor:not-allowed}
    .toggle{
      margin-left:auto;
      display:flex; gap:10px; align-items:center;
      color:var(--muted); font-size:13px;
      border:1px solid var(--line); padding:8px 12px; border-radius:999px;
      background: rgba(255,255,255,.02);
    }
    .toggle input{width:16px; height:16px}
    .status{
      margin-top:12px;
      display:none;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color:var(--muted);
      font-size:13px;
    }
    .status.show{display:block}
    .status.error{
      border-color: rgba(180,35,24,.5);
      background: rgba(180,35,24,.12);
      color:#ffd7d3;
    }

    /* Result card */
    .result-wrap{position:sticky; top:16px}
    .big{
      font-size:26px; font-weight:900; margin:4px 0 8px;
      letter-spacing:.2px;
    }
    .big.good{color:#63f3a2}
    .big.bad{color:#ff6b6b}
    .kv{display:grid; grid-template-columns: 140px 1fr; gap:8px; margin-top:8px; font-size:14px}
    .kv div{color:var(--muted)}
    .kv b{color:var(--text); font-weight:700}
    .gauge{
      margin-top:14px;
      border:1px solid var(--line);
      border-radius:999px;
      height:14px;
      background: rgba(255,255,255,.04);
      overflow:hidden;
      position:relative;
    }
    .bar{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, #34d399, #60a5fa, #f59e0b, #fb7185);
      transition: width .25s ease;
    }
    .gauge-label{
      display:flex; justify-content:space-between;
      margin-top:8px; font-size:12px; color:var(--muted)
    }
    .raw{
      margin-top:14px;
      background: rgba(0,0,0,.20);
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-size:12px;
      white-space:pre-wrap;
      overflow:auto;
      max-height: 260px;
    }

    /* Spinner */
    .spinner{
      width:14px; height:14px;
      border:2px solid rgba(255,255,255,.25);
      border-top-color: #fff;
      border-radius:50%;
      display:inline-block;
      animation: spin 0.8s linear infinite;
      vertical-align:-2px;
      margin-right:8px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    @media (max-width: 920px){
      .grid{grid-template-columns:1fr}
      .result-wrap{position:relative; top:auto}
    }
    @media (max-width: 620px){
      .inputs{grid-template-columns:1fr}
      .toggle{margin-left:0}
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <div>
        <h1>Churn Prediction</h1>
        <p class="sub">GitHub Pages frontend → calls FastAPI on Render</p>
      </div>
      <div class="pill">
        API:
        <a id="apiLink" href="#" target="_blank" rel="noreferrer">open</a>
      </div>
    </div>

    <div class="grid">
      <!-- Inputs -->
      <div class="card">
        <h3>Customer Inputs</h3>

        <div class="inputs">
          <div>
            <label>tenure</label>
            <input id="tenure" type="number" value="10" />
          </div>
          <div>
            <label>MonthlyCharges</label>
            <input id="MonthlyCharges" type="number" step="0.01" value="34" />
          </div>
          <div>
            <label>TotalCharges</label>
            <input id="TotalCharges" type="number" step="0.01" value="850" />
          </div>
          <div>
            <label>gender</label>
            <select id="gender"><option>Male</option><option>Female</option></select>
          </div>

          <div>
            <label>Contract</label>
            <select id="Contract">
              <option>Month-to-month</option><option>One year</option><option>Two year</option>
            </select>
          </div>
          <div>
            <label>PaymentMethod</label>
            <select id="PaymentMethod">
              <option>Electronic check</option>
              <option>Mailed check</option>
              <option>Bank transfer (automatic)</option>
              <option>Credit card (automatic)</option>
            </select>
          </div>

          <div>
            <label>InternetService</label>
            <select id="InternetService"><option>Fiber optic</option><option>DSL</option><option>No</option></select>
          </div>
          <div>
            <label>PhoneService</label>
            <select id="PhoneService"><option>Yes</option><option>No</option></select>
          </div>

          <div>
            <label>MultipleLines</label>
            <select id="MultipleLines"><option>No</option><option>Yes</option><option>No phone service</option></select>
          </div>
          <div>
            <label>Partner</label>
            <select id="Partner"><option>No</option><option>Yes</option></select>
          </div>

          <div>
            <label>Dependents</label>
            <select id="Dependents"><option>No</option><option>Yes</option></select>
          </div>
          <div>
            <label>PaperlessBilling</label>
            <select id="PaperlessBilling"><option>Yes</option><option>No</option></select>
          </div>

          <div>
            <label>OnlineSecurity</label>
            <select id="OnlineSecurity"><option>No</option><option>Yes</option><option>No internet service</option></select>
          </div>
          <div>
            <label>TechSupport</label>
            <select id="TechSupport"><option>No</option><option>Yes</option><option>No internet service</option></select>
          </div>

          <div>
            <label>OnlineBackup</label>
            <select id="OnlineBackup"><option>No</option><option>Yes</option><option>No internet service</option></select>
          </div>
          <div>
            <label>DeviceProtection</label>
            <select id="DeviceProtection"><option>No</option><option>Yes</option><option>No internet service</option></select>
          </div>

          <div>
            <label>StreamingTV</label>
            <select id="StreamingTV"><option>No</option><option>Yes</option><option>No internet service</option></select>
          </div>
          <div>
            <label>StreamingMovies</label>
            <select id="StreamingMovies"><option>No</option><option>Yes</option><option>No internet service</option></select>
          </div>
        </div>

        <div class="row">
          <button id="predictBtn" onclick="predict()">Predict</button>
          <button class="secondary" onclick="loadSample()">Load sample</button>
          <button class="secondary" onclick="resetForm()">Reset</button>

          <div class="toggle" title="Auto-run prediction when you change inputs">
            <input id="autoPredict" type="checkbox" checked />
            <span>Auto predict</span>
          </div>
        </div>

        <div id="status" class="status"></div>
      </div>

      <!-- Results -->
      <div class="result-wrap">
        <div class="card">
          <h3>Result</h3>

          <div id="headline" class="big">No prediction yet</div>

          <div class="gauge" aria-label="probability gauge">
            <div id="bar" class="bar"></div>
          </div>
          <div class="gauge-label">
            <span>0%</span>
            <span id="probText">—</span>
            <span>100%</span>
          </div>

          <div class="kv">
            <div>Probability</div><div><b id="probVal">—</b></div>
            <div>Threshold</div><div><b id="thrVal">—</b></div>
            <div>Model</div><div><b id="modelVal">—</b></div>
          </div>

          <div class="raw" id="raw">{}</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = "https://churn-fastapi-af07.onrender.com/predict";
    document.getElementById("apiLink").href = API_URL;

    // Elements
    const statusEl = document.getElementById("status");
    const btn = document.getElementById("predictBtn");
    const headline = document.getElementById("headline");
    const raw = document.getElementById("raw");
    const bar = document.getElementById("bar");
    const probText = document.getElementById("probText");
    const probVal = document.getElementById("probVal");
    const thrVal = document.getElementById("thrVal");
    const modelVal = document.getElementById("modelVal");
    const autoPredict = document.getElementById("autoPredict");

    function getVal(id){
      const el = document.getElementById(id);
      if (!el) return null;
      if (el.type === "number") return Number(el.value);
      return el.value;
    }

    function buildPayload(){
      return {
        data: {
          tenure: getVal("tenure"),
          MonthlyCharges: getVal("MonthlyCharges"),
          TotalCharges: getVal("TotalCharges"),
          gender: getVal("gender"),
          Contract: getVal("Contract"),
          PaymentMethod: getVal("PaymentMethod"),
          InternetService: getVal("InternetService"),
          PhoneService: getVal("PhoneService"),
          MultipleLines: getVal("MultipleLines"),
          Partner: getVal("Partner"),
          Dependents: getVal("Dependents"),
          PaperlessBilling: getVal("PaperlessBilling"),
          OnlineSecurity: getVal("OnlineSecurity"),
          TechSupport: getVal("TechSupport"),
          OnlineBackup: getVal("OnlineBackup"),
          DeviceProtection: getVal("DeviceProtection"),
          StreamingTV: getVal("StreamingTV"),
          StreamingMovies: getVal("StreamingMovies"),
        }
      };
    }

    function setStatus(msg, kind="info"){
      statusEl.className = "status show" + (kind === "error" ? " error" : "");
      statusEl.innerHTML = msg;
    }

    function clearStatus(){
      statusEl.className = "status";
      statusEl.innerHTML = "";
    }

    function setLoading(on){
      if(on){
        btn.disabled = true;
        btn.innerHTML = `<span class="spinner"></span>Predicting...`;
      } else {
        btn.disabled = false;
        btn.innerHTML = "Predict";
      }
    }

    function updateUI(json){
      raw.textContent = JSON.stringify(json, null, 2);

      const p = Number(json.churn_probability ?? 0);
      const pct = Math.max(0, Math.min(100, p * 100));

      bar.style.width = pct.toFixed(1) + "%";
      probText.textContent = pct.toFixed(2) + "%";
      probVal.textContent = pct.toFixed(2) + "%";
      thrVal.textContent = json.threshold_used ?? "—";
      modelVal.textContent = json.model_version ?? "—";

      const isChurn = Number(json.churn_prediction) === 1;
      headline.textContent = isChurn ? "Churn" : "No Churn";
      headline.className = "big " + (isChurn ? "bad" : "good");
    }

    // Debounce for auto predict
    let timer = null;
    function schedulePredict(){
      if(!autoPredict.checked) return;
      if(timer) clearTimeout(timer);
      timer = setTimeout(() => predict(), 400);
    }

    async function predict(){
      clearStatus();
      setLoading(true);

      const payload = buildPayload();

      try{
        const res = await fetch(API_URL, {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify(payload)
        });

        const text = await res.text();
        let json;
        try { json = JSON.parse(text); }
        catch { json = { raw: text }; }

        if(!res.ok){
          raw.textContent = JSON.stringify(json, null, 2);
          setStatus(`❌ <b>Error ${res.status}</b><br>${json.detail || text}`, "error");
          setLoading(false);
          return;
        }

        updateUI(json);
        setLoading(false);
      } catch(e){
        setStatus(`❌ <b>Network error</b><br>${String(e)}`, "error");
        setLoading(false);
      }
    }

    function loadSample(){
      const sample = {
        tenure: 10,
        MonthlyCharges: 34,
        TotalCharges: 850,
        gender: "Male",
        Contract: "Month-to-month",
        PaymentMethod: "Electronic check",
        InternetService: "Fiber optic",
        PhoneService: "Yes",
        MultipleLines: "No",
        Partner: "No",
        Dependents: "No",
        PaperlessBilling: "Yes",
        OnlineSecurity: "No",
        TechSupport: "No",
        OnlineBackup: "No",
        DeviceProtection: "No",
        StreamingTV: "No",
        StreamingMovies: "Yes"
      };

      for (const [k,v] of Object.entries(sample)){
        const el = document.getElementById(k);
        if(!el) continue;
        el.value = v;
      }
      schedulePredict();
    }

    function resetForm(){
      document.getElementById("tenure").value = 12;
      document.getElementById("MonthlyCharges").value = 70.35;
      document.getElementById("TotalCharges").value = 850;
      document.getElementById("gender").value = "Male";
      document.getElementById("Contract").value = "Month-to-month";
      document.getElementById("PaymentMethod").value = "Electronic check";
      document.getElementById("InternetService").value = "Fiber optic";
      document.getElementById("PhoneService").value = "Yes";
      document.getElementById("MultipleLines").value = "No";
      document.getElementById("Partner").value = "No";
      document.getElementById("Dependents").value = "No";
      document.getElementById("PaperlessBilling").value = "Yes";
      document.getElementById("OnlineSecurity").value = "No";
      document.getElementById("TechSupport").value = "No";
      document.getElementById("OnlineBackup").value = "No";
      document.getElementById("DeviceProtection").value = "No";
      document.getElementById("StreamingTV").value = "No";
      document.getElementById("StreamingMovies").value = "Yes";

      headline.textContent = "No prediction yet";
      headline.className = "big";
      bar.style.width = "0%";
      probText.textContent = "—";
      probVal.textContent = "—";
      thrVal.textContent = "—";
      modelVal.textContent = "—";
      raw.textContent = "{}";
      clearStatus();
    }

    // Make it interactive: predict when inputs change (if auto enabled)
    const ids = [
      "tenure","MonthlyCharges","TotalCharges","gender","Contract","PaymentMethod","InternetService",
      "PhoneService","MultipleLines","Partner","Dependents","PaperlessBilling","OnlineSecurity","TechSupport",
      "OnlineBackup","DeviceProtection","StreamingTV","StreamingMovies"
    ];
    ids.forEach(id=>{
      const el = document.getElementById(id);
      if(!el) return;
      el.addEventListener("input", schedulePredict);
      el.addEventListener("change", schedulePredict);
    });

    // Run one prediction on page load (optional)
    window.addEventListener("load", () => {
      schedulePredict();
    });
  </script>
</body>
</html>
